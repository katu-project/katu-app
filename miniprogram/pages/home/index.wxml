<cu-custom></cu-custom>
<view class="home-bg">
  <image class="topLogo" mode="aspectFit" src="/static/logo-t.svg"></image>
</view>

<view class="flex align-end justify-end padding-lr">
  <view class="flex align-end">
    <view class="search margin-bottom" bindtap="tapToShowNotice">
      <image class="right-item" mode="aspectFit" src="/static/images/bell.svg"></image>
      <view wx:if="{{notice._id}}" class="dot"></view>
    </view>
    <view class="notice margin" bindtap="tapToSearch">
      <image class="right-item" mode="aspectFit" src="/static/images/search.svg"></image>
    </view>
  </view>
</view>

<view wx:if="{{!likeList.length}}" class="padding-lr-sm scroll-item cate-list">
  <template is="cateList" data="{{isRefresh,cateList}}"/>
</view>
<scroll-view 
  wx:else
  scroll-x
  enable-flex
  enhanced
  show-scrollbar="{{false}}"
  paging-enabled>
  <view style="width: 200vw;" class="flex-row">
    <view class="padding-lr-sm scroll-item like-list">
      <scroll-view
        scroll-y
        enable-flex
        refresher-enabled
        show-scrollbar="{{false}}"
        data-view="Like"
        bindrefresherrefresh="onBindRefresh"
        refresher-triggered="{{isRefresh}}"
        >
        <view style="height: 68vh;">
          <view class="margin-bottom-sm padding-lr flex flex-wrap justify-between" style="align-content: flex-start;">
            <block wx:for="{{likeList}}" wx:key="index">
              <view style="position: relative;" class="margin-bottom-sm item shadow bg-black flex-col justify-around align-center" data-item="{{item}}" bindtap="tapToCardDetail">
                  <image class="img" lazy-load="true" binderror="onBindLoadError" mode="{{item._mode || 'aspectFit'}}" data-idx="{{index}}" src="{{item._url}}"></image>
                  <text hidden="{{!item._showEncryptIcon}}" class="encrypt-icon cuIcon-lock text-grey"></text>
                  <text class="text-white">{{item.title}}</text>
              </view>
            </block>
          </view>
        </view>
      </scroll-view>
    </view>
    <view class="padding-lr-sm scroll-item cate-list">
      <template is="cateList" data="{{isRefresh,cateList}}"/>
    </view>
  </view>
</scroll-view>

<view class="cu-modal {{showNotice?'show':''}}">
  <view class="cu-dialog bg-white" style="width: 75vw;">
    <view class="cu-bar justify-end">
      <view class="content">消息提示</view>
      <view class="action" data-name="showNotice" bindtap="tapToHideModal">
        <text class="cuIcon-close text-red"></text>
      </view>
    </view>
    <view class="padding-tb-sm padding-lr margin-lr text-left solids-top solids">
      <view style="height: 40vh;overflow-y: scroll;" class="flex-col">
        <rich-text style="flex:1" nodes="{{notice.content}}"></rich-text>
        <text class="text-right padding-top">{{notice.time}}</text>
      </view>
    </view>
    <view class="action flex justify-center">
      <view class="padding-sm margin-sm bg-cyan light br-10" bindtap="tapToMarkRead" style="width:50vw">
        <text class="text-cyan">我知道了</text>
      </view>
    </view>
  </view>
</view>


<template name="cateList">
  <scroll-view
  scroll-y
  enable-flex
  refresher-enabled
  show-scrollbar="{{false}}"
  data-view="Cate"
  bindrefresherrefresh="onBindRefresh"
  refresher-triggered="{{isRefresh}}"
  >
    <view style="height: 68vh;">
      <view class="margin-bottom-sm padding-lr flex flex-wrap justify-between" style="align-content: flex-start;">
        <block wx:for="{{cateList}}" wx:key="name">
          <view wx:if="{{item}}" class="item margin-bottom-sm shadow bg-black flex-row justify-around align-center" data-tag="{{item.name}}" bindtap="tapToCardList">
            <view class="cate-name bg-{{item.color || 'cyan'}} light flex justify-center align-center">
              <text class="{{item.name.length>3?'text-sm':'text-lg'}}">{{item.name}}</text>
            </view>
            <text class="text-white text-xxl">{{item.count}}</text>
          </view>
        </block>
        <view class="flex-col justify-center align-center" style="width: 100%;height: 50vh;" wx:if="{{!cateList.length}}">
          <text class="text-xl text-white">暂无数据</text>
          <text class="text-grey padding">点击下方按钮开始创建卡片数据吧</text>
          <text class="text-xxl text-grey">
            <text class="cuIcon-rounddown"></text>
          </text>
        </view>
      </view>
    </view>
  </scroll-view>
</template>
